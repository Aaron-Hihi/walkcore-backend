generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//* === Enums ===
enum Gender {
  MALE
  FEMALE
}

enum SessionMode {
  SOLO
  REMOTE
}

enum SessionStatus {
  PLANNED
  ONGOING
  FINISHED
  CANCELLED
}


enum Visibility {
  PUBLIC
  FRIENDONLY
  INVITEONLY
}

enum ParticipantStatus {
  JOINED
  LEFT
  FINISHED
}

enum ItemType{
  AVATAR
  BANNER
}

enum RequirementType{
  STEP
  SESSION
  ACTIVE
}

//* === Models ===
model User {
  id        BigInt  @id @default(autoincrement())
  username  String  @unique
  email     String  @unique
  password  String

  tokenVersion Int    @default(0)

  dateOfBirth   DateTime?
  gender    Gender?
  height    Decimal?  @db.Decimal(10,2)
  weight    Decimal?  @db.Decimal(10,2)

  currency  Int       @default(0)

  totalSteps          BigInt  @default(0)
  totalDistance       Decimal @db.Decimal(10,2) @default(0)
  totalActiveTime     Int     @default(0)
  totalSessionTime    Int     @default(0)
  totalSessionCount   Int     @default(0)
  totalCaloriesBurned Int     @default(0)

  longestStreak Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessionsCreated Session[]
  participants     SessionParticipant[]
  dailyActivities  UserDailyActivity[]
  ownedItem User_Item[]
  unlockedAchievement User_Achievement[]
}

model UserDailyActivity {
  id        BigInt      @id @default(autoincrement())
  userId    BigInt
  date      DateTime    @db.Date

  stepsWalked    Int
  distance       Decimal  @db.Decimal(10,2)
  activeTime     Int
  sessionTime    Int
  sessionCount   Int
  caloriesBurned Int
  currencyEarned Int

  user User @relation(fields: [userId], references: [id])

  @@unique([userId, date])
}

model Session {
  id              BigInt @id @default(autoincrement())
  creatorId       BigInt

  title           String
  description     String?

  mode            SessionMode
  status          SessionStatus   @default(PLANNED)
  visibility      Visibility      @default(PUBLIC)

  maxParticipants Int
  stepTarget      Int

  startTime DateTime
  endTime   DateTime

  startLat  Decimal?  @db.Decimal(10,7)
  startLong Decimal?  @db.Decimal(10,7)

  creator User @relation(fields: [creatorId], references: [id])
  participants SessionParticipant[]
}

model SessionParticipant {
  id        BigInt @id @default(autoincrement())

  sessionId BigInt
  userId    BigInt

  status    ParticipantStatus
  isAdmin   Boolean @default(false)

  stepTarget Int?
  totalSteps Int?

  joinTime  DateTime @default(now())
  leaveTime DateTime?

  currencyEarned  Int?
  caloriesBurned  Int?
  approxDistance Decimal? @db.Decimal(10,2)

  session Session @relation(fields: [sessionId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@unique([sessionId, userId])
}


model User_Item {
  id     Int     @id @default(autoincrement())
  acquiredAt   DateTime
  isEquipped Boolean
  user User @relation (fields: [userId], references: [id])
  userId BigInt
  shopItem Shop_Item @relation (fields: [shopId], references: [id])
  shopId Int

}



model Shop_Item {
  id     Int     @id @default(autoincrement())
  name String
  description String
  price Int
  itemType ItemType
  imageUrl String
  userItem User_Item[]

}

model User_Achievement {
  id     Int     @id @default(autoincrement())
  isCompleted   Boolean
  completedAt DateTime?
  user User @relation (fields: [userId], references: [id])
  userId BigInt
  achievement Achievement @relation (fields: [achievementId], references: [id])
  achievementId Int
}



model Achievement {
  id     Int     @id @default(autoincrement())
  title String
  description String
  requirementType RequirementType
  requirementValue Int
  reward Int
  userAchievement User_Achievement[]

}